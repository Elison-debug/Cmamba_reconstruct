<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   width="800"
   height="900"
   viewBox="0 0 800 900"
   inkscape:version="1.4.3 (0d15f75, 2025-12-25)"
   version="1.1"
   id="svg21"
   sodipodi:docname="MAMBAFlow.svg"
   inkscape:export-filename="MAMBAFlow.svg"
   inkscape:export-xdpi="96"
   inkscape:export-ydpi="96"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview21"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="0.86333333"
     inkscape:cx="399.6139"
     inkscape:cy="447.6834"
     inkscape:window-width="1920"
     inkscape:window-height="991"
     inkscape:window-x="-9"
     inkscape:window-y="-9"
     inkscape:window-maximized="1"
     inkscape:current-layer="g12" />
  <defs
     id="defs2">
    <marker
       id="arrowhead"
       markerWidth="10"
       markerHeight="7"
       refX="9"
       refY="3.5"
       orient="auto">
      <polygon
         points="0 0, 10 3.5, 0 7"
         fill="#555"
         id="polygon1" />
    </marker>
    <marker
       id="arrowhead-grey"
       markerWidth="10"
       markerHeight="7"
       refX="9"
       refY="3.5"
       orient="auto">
      <polygon
         points="0 0, 10 3.5, 0 7"
         fill="#999"
         id="polygon2" />
    </marker>
    <style
       id="style2">
      /* 通用块样式 */
      .block-base { stroke-width: 2px; rx: 5px; ry: 5px; }
      /* 颜色定义 */
      .fill-cyan { fill: #AEEEEE; stroke: #5F9EA0; }    /* Input, Conv, EMA, Residual */
      .fill-purple { fill: #D8BFD8; stroke: #9370DB; }  /* Normalization */
      .fill-pink { fill: #FFB6C1; stroke: #DB7093; }    /* Linear in/out proj */
      .fill-orange { fill: #FFDAB9; stroke: #FFA500; }  /* Elementwise */
      .fill-light-purple { fill: #E6E6FA; stroke: #B0C4DE; } /* Gate path */
      .stroke-red-box { fill: none; stroke: #FF0000; stroke-width: 2px; } /* Red group box */

      /* 文本样式 */
      .text-label { font-family: Arial, Helvetica, sans-serif; text-anchor: middle; fill: #000; font-size: 14px; }
      .text-italic { font-style: italic; }

      /* 连接线样式 */
      .connector { fill: none; stroke: #555; stroke-width: 2px; marker-end: url(#arrowhead); stroke-linecap: round; stroke-linejoin: round; }
      .connector-grey { fill: none; stroke: #999; stroke-width: 2px; marker-end: url(#arrowhead-grey); stroke-linecap: round; stroke-linejoin: round; }
    </style>
    <marker
       id="arrowhead-grey-8"
       markerWidth="10"
       markerHeight="7"
       refX="9"
       refY="3.5"
       orient="auto"
       viewBox="0 0 10 7"
       preserveAspectRatio="xMidYMid">
      <polygon
         points="10,3.5 0,7 0,0 "
         fill="#999999"
         id="polygon2-9" />
    </marker>
  </defs>
  <g
     inkscape:groupmode="layer"
     inkscape:label="1. 背景框和组"
     id="g2">
    <rect
       x="300"
       y="50"
       width="200"
       height="50"
       class="block-base fill-cyan"
       id="block_input" />
    <rect
       x="300"
       y="130"
       width="200"
       height="50"
       class="block-base fill-purple"
       id="block_norm" />
    <rect
       x="250"
       y="210"
       width="300"
       height="50"
       class="block-base fill-pink"
       id="block_linear_in" />
    <rect
       x="150"
       y="300"
       width="350"
       height="280"
       class="block-base stroke-red-box"
       id="group_red_box" />
    <rect
       x="175"
       y="320"
       width="300"
       height="60"
       class="block-base fill-cyan"
       id="block_conv" />
    <rect
       x="175"
       y="410"
       width="300"
       height="60"
       class="block-base fill-cyan"
       id="block_ema" />
    <rect
       x="175"
       y="500"
       width="300"
       height="60"
       class="block-base fill-orange"
       id="block_elementwise" />
    <rect
       x="550"
       y="320"
       width="200"
       height="50"
       class="block-base fill-light-purple"
       id="block_gate" />
    <rect
       x="250"
       y="620"
       width="300"
       height="50"
       class="block-base fill-pink"
       id="block_linear_out" />
    <rect
       x="300"
       y="700"
       width="200"
       height="50"
       class="block-base fill-cyan"
       id="block_residual" />
  </g>
  <g
     inkscape:groupmode="layer"
     inkscape:label="2. 文本标签"
     id="g12">
    <text
       x="400"
       y="80"
       class="text-label"
       id="text2"><tspan
         style="font-size:21.3333px"
         id="tspan2">I</tspan><tspan
         style="font-size:21.3333px"
         id="tspan1">nput tokens x_t</tspan></text>
    <text
       x="400"
       y="160"
       class="text-label"
       id="text3"
       style="font-size:21.3333px">Normalization</text>
    <text
       x="398.84167"
       y="240"
       class="text-label"
       id="text4"
       style="font-size:20px">Linear in_proj splits into u_t, v_t</text>
    <text
       x="325"
       y="345"
       class="text-label"
       id="text5"
       style="font-size:21.3333px">dt_projection on u_t</text>
    <text
       x="325"
       y="365"
       class="text-label text-italic"
       id="text6"
       style="font-size:18.6667px">(MVM + Sigmoid)</text>
    <text
       x="325"
       y="435"
       class="text-label"
       id="text7"
       style="font-size:21.3333px">EMA-style selective scan</text>
    <text
       x="325"
       y="455"
       class="text-label"
       id="text8"
       style="font-size:21.3333px">across sequence</text>
    <text
       x="325"
       y="535"
       class="text-label"
       id="text9"
       style="font-size:21.3333px">Elementwise product with gate</text>
    <text
       x="650"
       y="350"
       class="text-label"
       id="text10"
       style="font-size:18.6667px">Gate path: sigmoid(v_t)</text>
    <text
       x="400"
       y="650"
       class="text-label"
       id="text11"
       style="font-size:21.3333px">Linear out_proj</text>
    <text
       x="400"
       y="730"
       class="text-label"
       id="text12"
       style="font-size:20px">Residual add with x_t</text>
    <text
       xml:space="preserve"
       style="font-weight:bold;font-size:24px;font-family:Arial, Helvetica, sans-serif;-inkscape-font-specification:'Arial, Helvetica, sans-serif Bold';writing-mode:lr-tb;direction:ltr;fill:#ff0000;fill-opacity:0.866667;stroke:#ffffff;stroke-width:1.515;stroke-opacity:1"
       x="162.16216"
       y="293.05017"
       id="text21"><tspan
         sodipodi:role="line"
         id="tspan21"
         x="162.16216"
         y="293.05017"
         style="font-style:normal;font-variant:normal;font-weight:900;font-stretch:normal;font-family:Arial;-inkscape-font-specification:'Arial Heavy';fill:#ff0000;fill-opacity:0.866667;stroke:#ffffff;stroke-opacity:1">SSM</tspan></text>
  </g>
  <g
     inkscape:groupmode="layer"
     inkscape:label="3. 连接线"
     id="g21">
    <path
       d="M 400 100 V 130"
       class="connector"
       id="path12" />
    <path
       d="M 400 180 V 210"
       class="connector"
       id="path13" />
    <path
       d="M 325 260 V 320"
       class="connector"
       id="path14" />
    <path
       d="M 325 380 V 410"
       class="connector"
       id="path15" />
    <path
       d="M 325 470 V 500"
       class="connector"
       id="path16" />
    <path
       d="M 325 560 V 620"
       class="connector"
       id="path17" />
    <path
       d="M 400 670 V 700"
       class="connector"
       id="path18" />
    <path
       d="M 650 370 C 650 530, 475 530, 475 530"
       class="connector-grey"
       fill="none"
       id="path20" />
    <path
       style="fill:none;stroke:#919191;stroke-width:1.515;marker-end:url(#arrowhead-grey-8);stroke-opacity:1"
       d="m 551.35135,231.66023 c 81.08108,20.84942 94.9807,85.71429 94.9807,85.71429"
       id="path21" />
  </g>
</svg>
